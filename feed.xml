<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.3">Jekyll</generator><link href="/feed.xml" rel="self" type="application/atom+xml" /><link href="/" rel="alternate" type="text/html" /><updated>2018-09-18T08:00:48-05:00</updated><id>/feed.xml</id><title type="html">Stephen Aument</title><subtitle>Compassionate Coder. Leader of Teams. CTO @ ReadyRosie.</subtitle><author><name>Stephen Aument</name></author><entry><title type="html">Backbone Collection Testing Gotcha</title><link href="/blog/backbone-collection-testing-gotcha/" rel="alternate" type="text/html" title="Backbone Collection Testing Gotcha" /><published>2014-03-12T16:46:04-05:00</published><updated>2014-03-12T16:46:04-05:00</updated><id>/blog/backbone-collection-testing-gotcha</id><content type="html" xml:base="/blog/backbone-collection-testing-gotcha/">&lt;p&gt;Be careful of this gotcha when testing a &lt;a href=&quot;http://backbonejs.org/&quot;&gt;Backbone.js&lt;/a&gt;
collection. I don’t have much experience with Backbone, so this is probably
obvious to more experienced users, but hopefully this will help somebody else,
or at least myself in the future.&lt;/p&gt;

&lt;p&gt;Today I needed to test the behavior of a Collection with a certain number of
Models in it. I didn’t care about the content of the models, just that they
contained a certain field. So, my pair and I came up with this setup to run
in our &lt;a href=&quot;http://jasmine.github.io/&quot;&gt;Jasmine&lt;/a&gt; specs:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;nx&quot;&gt;provider&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WellMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;display_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'a'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;&lt;span class=&quot;nx&quot;&gt;providerArray&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;provider&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;&lt;span class=&quot;nx&quot;&gt;providers&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WellMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Collections&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Providers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;providerArray&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;We created an array of dummy models and passed them into our Collection. This
is one way you can create and populate a Collection. You pass in your array of
models and they become the models in the Collection.&lt;/p&gt;

&lt;blockquote class=&quot;largeQuote&quot;&gt;
If that &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;providerArray&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;provider&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;&lt;/code&gt; syntax freaks you out, don't worry. It's just a bit of fancy CoffeeScript and all you need to understand for now is that it creates an 18 item array with each element being &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;provider&lt;/span&gt;&lt;/code&gt;.
&lt;/blockquote&gt;

&lt;p&gt;Makes sense, right? Well, our test failed and when we started debugging in the
browser, here’s what we saw:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;nx&quot;&gt;Providers&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;fullParams&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_byId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_events&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;…&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;What??? &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;? When we looked into the models array it
contained a single item from the array we passed in.&lt;/p&gt;

&lt;p&gt;Next we tried setting the models array after the fact:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;nx&quot;&gt;provider&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WellMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;display_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'a'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;&lt;span class=&quot;nx&quot;&gt;providers&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WellMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Collections&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Providers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;&lt;span class=&quot;nx&quot;&gt;providers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;providerArray&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The models array seems right now, but the collection length was still one:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;nx&quot;&gt;Providers&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;fullParams&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_byId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_events&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;…&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This was just as baffling. By this time we had called in &lt;a href=&quot;@timtyrrell&quot;&gt;Tim
Tyrell&lt;/a&gt; to tell us what we were doing wrong. Tim had the foresight
to read, not just the docs for the Backbone Collection &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;initializer&lt;/span&gt;&lt;/code&gt; method, but
also the documentation for the &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;add&lt;/span&gt;&lt;/code&gt; method, which had this to say (emphasis
added):&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;em&gt;If you’re adding models to the collection that are already in the collection,
they’ll be ignored&lt;/em&gt;, unless you pass {merge: true}, in which case their
attributes will be merged into the corresponding models, firing any
appropriate “change” events.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Interesting! When add is called, it ignores any objects that are already
present in the models array. Since we are using the same model instance in each
position of our array, only the first one is being stored. The rest are being
dumped.&lt;/p&gt;

&lt;p&gt;A quick check of the &lt;a href=&quot;https://github.com/jashkenas/backbone/blob/master/backbone.js#L785-L799&quot;&gt;Backbone source
code&lt;/a&gt;
confirms that the initialize method is calling &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;reset&lt;/span&gt;&lt;/code&gt; with the array you pass
in, which iterates over the array and calls &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;add&lt;/span&gt;&lt;/code&gt; for each.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;cm&quot;&gt;/* Excerpt starting at line 785 */&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// When you have more items than you want to add or remove individually,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// you can reset the entire set with a new list of models, without firing&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// any granular &amp;lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&amp;gt;&amp;lt;span class=&quot;nx&quot;&amp;gt;add&amp;lt;/span&amp;gt;&amp;lt;/code&amp;gt; or &amp;lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&amp;gt;&amp;lt;span class=&quot;nx&quot;&amp;gt;remove&amp;lt;/span&amp;gt;&amp;lt;/code&amp;gt; events. Fires &amp;lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&amp;gt;&amp;lt;span class=&quot;nx&quot;&amp;gt;reset&amp;lt;/span&amp;gt;&amp;lt;/code&amp;gt; when finished.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// Useful for bulk operations and optimizations.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;&lt;span class=&quot;nx&quot;&gt;reset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{});&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_removeReference&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;previousModels&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;  &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_reset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;silent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;silent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;trigger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'reset'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;So, my pair, Curtis Ekstrom decided to try creating a new object for each
element of the array with the same data to see if that would work.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;nx&quot;&gt;providerArray&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WellMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;display_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'a'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;&lt;span class=&quot;nx&quot;&gt;providers&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WellMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Collections&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Providers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;providerArray&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;And so it did. At first I thought that Backbone was performing a simple object
identity check (===) vs an equality check (==). That would make sense of the
behavior we saw, but when I read the &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;add&lt;/span&gt;&lt;/code&gt; documentation again, I saw that
passing &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;merge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt; along with the model or model array would result in the
attributes passed in being merged into the existing objects. It must be doing
something else entirely.&lt;/p&gt;

&lt;p&gt;Another peek into the &lt;a href=&quot;https://github.com/jashkenas/backbone/blob/master/backbone.js#L718-L728&quot;&gt;source
code&lt;/a&gt;
confirms. &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;add&lt;/span&gt;&lt;/code&gt; calls &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;kd&quot;&gt;set&lt;/span&gt;&lt;/code&gt;, which contains the relevant:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;cm&quot;&gt;/* Except starting at line 718 */&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// If a duplicate is found, prevent it from being added and&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// optionally merge it into the existing model.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;existing&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;modelMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;existing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;cid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;merge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;    &lt;span class=&quot;nx&quot;&gt;attrs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;attrs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;model&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attributes&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;attrs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;attrs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;existing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attrs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;    &lt;span class=&quot;nx&quot;&gt;existing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attrs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;sortable&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;sort&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;existing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;hasChanged&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;sortAttr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sort&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;  &lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;existing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;That first line &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;existing&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/code&gt; is the key. It looks for an
existing model in the &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;_byId&lt;/span&gt;&lt;/code&gt; object hash, with the same &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;&lt;/code&gt;, &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;cid&lt;/span&gt;&lt;/code&gt; or that is the
object itself. If it finds it, and &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;merge&lt;/span&gt;&lt;/code&gt; is not &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;/code&gt; it rejects the model.&lt;/p&gt;

&lt;p&gt;TL;DR - Make sure each Model in the array you pass to the Collection
initializer is a distinct instance, even if the data is otherwise identincal.&lt;/p&gt;</content><author><name>Step Aument</name></author><category term="code" /><summary type="html">Be careful of this gotcha when testing a Backbone.js collection.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="/%7B%22credit%22=%3E%22Photo%20by%20Anita%20Jankovic%20on%20Unsplash%22,%20%22feature%22=%3E%22/assets/images/hero/anita-jankovic-730367-unsplash.jpg%22,%20%22topPosition%22=%3E%22-200px%22%7D" /></entry><entry><title type="html">Null Object Part 2</title><link href="/blog/null-object-part-2/" rel="alternate" type="text/html" title="Null Object Part 2" /><published>2014-03-11T01:00:00-05:00</published><updated>2014-03-11T01:00:00-05:00</updated><id>/blog/null-object-part-2</id><content type="html" xml:base="/blog/null-object-part-2/">&lt;p&gt;In a &lt;a href=&quot;/blog/2014/03/05/the-null-object-pattern-and-method-missing-in-ruby/&quot;&gt;previous post&lt;/a&gt; I
described using &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt; in a Null Object to stand in for another
object and respond smartly to the original object’s interface. At the end of
that post I suggested that you could go farther than we did in creating a more
abstract object. Well, we got that chance.&lt;/p&gt;

&lt;p&gt;In this post I will show you how we created a &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt; that can both stand
on its own and be extended with added functionality in a subclass. Our
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt; needs to be smart about the interface of the class that it’s
faking, so we’ll have to take that into account. Finally, we decided to
implement a smart &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;respond_to?&lt;/span&gt;&lt;/code&gt; method to round out the functionality of our
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Here’s the form that our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; took at the end of the previous post:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilDuck&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Duck'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'sleeping'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'gray'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;method_missing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-19&quot;&gt;    &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-20&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ends_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'?'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-21&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-22&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;A few days after making those changes, we ran into another custom Null Object
in our app, the &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilGoose&lt;/span&gt;&lt;/code&gt;. Our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilGoose&lt;/span&gt;&lt;/code&gt; ran into the
same problem that &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; originally did. A new method was added to the
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Goose&lt;/span&gt;&lt;/code&gt; class that wasn’t reflected in &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilGoose&lt;/span&gt;&lt;/code&gt; and a bug appeared.&lt;/p&gt;

&lt;p&gt;What to do? Well, we try not to run ahead of ourselves or our tests, so the
first thing we did was create a test that expected the missing method, watched
it fail, and copied the &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt; definition from &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt;, renaming as
we needed to.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilGoose&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Goose'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'awake'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'black'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;method_missing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-19&quot;&gt;    &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Goose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-20&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ends_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'?'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-21&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This made our test happy. But the duplicated code made us sad. We like
&lt;a href=&quot;http://en.wikipedia.org/wiki/Don't_repeat_yourself&quot;&gt;DRY&lt;/a&gt; code around here. We
knew it was time to factor out our common code into a single spot.&lt;/p&gt;

&lt;p&gt;We thought about putting it in a Module that could be included into other
special null objects, but decided instead to make it a full-fledged &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt;
class that we could use standalone as well as a superclass for our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt;
and &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilGoose&lt;/span&gt;&lt;/code&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilObject&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;klass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;vi&quot;&gt;@klass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;klass&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;method_missing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@klass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ends_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'?'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;If you recall in our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt; implementation, we had to new up an
instance of our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; class to determine whether it responds to the method we
are testing. Since we want to reuse this method in the generic &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt;, we
won’t know which class to check. Our first pass at a solution requires the
class to be passed into the &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt; constructor, which would look like
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;faker&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;In our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;initialize&lt;/span&gt;&lt;/code&gt; method we save the class passed in into an instance
variable, &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;vi&quot;&gt;@klass&lt;/span&gt;&lt;/code&gt;, which &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt; then uses to new up an instance to
check. Now we can fake any class we want with our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt;, and it will
handle exactly those methods the subject responds to and no others. (Note: If
you’re weirded out by passing a class around like that, remember that
everything in Ruby is an object, including classes)&lt;/p&gt;

&lt;p&gt;Now we can make &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; inherit from &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt;:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilDuck&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Duck'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'sleeping'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'gray'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;and the same for &lt;code class=&quot;highlighter-rouge&quot;&gt;NilGoose&lt;/code&gt;:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilGoose&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Goose'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'awake'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'black'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This is all very cool, but if I leave the code like this I’m going to have to
run around and find every place in the app in which I create an instance of
&lt;code class=&quot;highlighter-rouge&quot;&gt;NilDuck&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;NilGoose&lt;/code&gt; and add the new argument. Hopefully it’s not very many
places, but this is not something I want to do. Let’s go ahead and add
initialize methods to our &lt;code class=&quot;highlighter-rouge&quot;&gt;NilDuck&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;NilGoose&lt;/code&gt; classes to take care of
that:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilDuck&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initialize&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Duck'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'sleeping'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'gray'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-19&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-20&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-21&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilGoose&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initialize&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Goose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Goose'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'awake'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'black'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-19&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-20&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-21&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;That works, and it keeps us from having to spread changes around the codebase,
but it does add to the duplication a bit. That initialize method needs to be
added to every new subclass in order to get the shorter &lt;code class=&quot;highlighter-rouge&quot;&gt;NilSomething.new&lt;/code&gt;
syntax. We could live with this, or we could find a way to bake that smarts
into &lt;code class=&quot;highlighter-rouge&quot;&gt;NilObject&lt;/code&gt; itself. But how?&lt;/p&gt;

&lt;p&gt;My pair for the week, &lt;a href=&quot;https://twitter.com/timtyrrell&quot;&gt;@timtyrell&lt;/a&gt; came up with
the idea of keying off of the classname of the &lt;code class=&quot;highlighter-rouge&quot;&gt;NilObject&lt;/code&gt; subclass. And that’s
exactly what we did, we made the class parameter optional and keyed off of the
classname.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilObject&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;klass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;vi&quot;&gt;@klass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;klass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;real_class_name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;method_missing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@klass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ends_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'?'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;real_class_name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;constantize&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;real_class_name&lt;/code&gt; method (naming is hard; this should probably be
&lt;code class=&quot;highlighter-rouge&quot;&gt;subject_class_name&lt;/code&gt; or something) takes the name of the class, &lt;code class=&quot;highlighter-rouge&quot;&gt;NilDuck&lt;/code&gt; or
&lt;code class=&quot;highlighter-rouge&quot;&gt;NilGoose&lt;/code&gt; and takes the substring that skips the first 3 letters (the length
of ‘Nil’) to the end. It then turns it into a constant so it can be
instantiated.&lt;/p&gt;

&lt;p&gt;As an added bonus we decided to implement &lt;code class=&quot;highlighter-rouge&quot;&gt;respond_to?&lt;/code&gt; so it behaves exactly
like the subject class would behave.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilObject&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;klass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;vi&quot;&gt;@klass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;klass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;real_class_name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;method_missing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ends_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'?'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;    &lt;span class=&quot;vi&quot;&gt;@klass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;real_class_name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;constantize&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;So there you have it. We now have a &lt;code class=&quot;highlighter-rouge&quot;&gt;NilObject&lt;/code&gt; that can stand in for any other
object like so: &lt;code class=&quot;highlighter-rouge&quot;&gt;NilObject.new(MyOtherClass)&lt;/code&gt; and it will respond to exactly
the same interface as &lt;code class=&quot;highlighter-rouge&quot;&gt;MyOtherClass&lt;/code&gt; and answer &lt;code class=&quot;highlighter-rouge&quot;&gt;respond_to?&lt;/code&gt; just like an
instance of &lt;code class=&quot;highlighter-rouge&quot;&gt;MyOtherClass&lt;/code&gt; would. If we need to override some of the methods of
&lt;code class=&quot;highlighter-rouge&quot;&gt;MyOtherClass&lt;/code&gt; to return other than &lt;code class=&quot;highlighter-rouge&quot;&gt;nil&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;false&lt;/code&gt; we can create a new
&lt;code class=&quot;highlighter-rouge&quot;&gt;NilMyOtherClass&lt;/code&gt; as a subclass of &lt;code class=&quot;highlighter-rouge&quot;&gt;NilObject&lt;/code&gt; and override what we need to.&lt;/p&gt;

&lt;p&gt;I’ll leave you with a thought exercise. What would happen if you instantiated a
&lt;code class=&quot;highlighter-rouge&quot;&gt;NilObject&lt;/code&gt; without passing a class to the constructor: &lt;code class=&quot;highlighter-rouge&quot;&gt;nil_object =
NilObject.new&lt;/code&gt;? What would you get? As a bonus, how would you make the code
inside the &lt;code class=&quot;highlighter-rouge&quot;&gt;real_class_name&lt;/code&gt; method more intention revealing than what we wrote?
Leave a comment if you know the answers.&lt;/p&gt;</content><author><name>Step Aument</name></author><category term="code" /><summary type="html">In a previous post I described using method_missing in a Null Object to stand in for another object and respond smartly to the original object’s interface. At the end of that post I suggested that you could go farther than we did in creating a more abstract object. Well, we got that chance.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="/%7B%22credit%22=%3E%22Photo%20by%20Ann%20H%20on%20Pexels%22,%20%22feature%22=%3E%22/assets/images/hero/bath-duck-close-up-cute-592677.jpg%22,%20%22topPosition%22=%3E%22-420px%22%7D" /></entry><entry><title type="html">Ruby Hash#fetch and Javascript</title><link href="/blog/ruby-hash-dot-fetch-and-javascript/" rel="alternate" type="text/html" title="Ruby Hash#fetch and Javascript" /><published>2014-03-06T19:21:15-06:00</published><updated>2014-03-06T19:21:15-06:00</updated><id>/blog/ruby-hash-dot-fetch-and-javascript</id><content type="html" xml:base="/blog/ruby-hash-dot-fetch-and-javascript/">&lt;p&gt;In a &lt;a href=&quot;/blog/2014/03/05/the-null-object-pattern-and-method-missing-in-ruby/&quot;&gt;previous
post&lt;/a&gt; I
mentioned a case in which I had a Haml template in a Rails app with Javascript
in it. The template was rendering Ruby values into what would become a JSON
object (Javascript Hash) in the browser. In that particular case, a method call
on a Null Object was returning nil and breaking the Javascript.&lt;/p&gt;

&lt;p&gt;Well, today I encountered another variation of this problem. In this case, I
had a Ruby Hash feeding values into the JSON object. It looked like this:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;gender&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;search_params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'gender'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;language&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;search_params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'language'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;query&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;search_params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'query'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;properties&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;search_params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'properties'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Two of these fields on the ruby hash are empty: &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;language&lt;/span&gt;&lt;/code&gt; and &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;/code&gt;.
Notice that this isn’t a problem for most of these fields, but for one it is:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;gender&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;M&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;27&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;language&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;query&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;specials&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                                                                                                                  &lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;properties&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;See that? The first four fields feed into double quotes as strings. If they are
empty, they are empty. It may cause an issue somewhere down the line, but the
Javascript itself is valid.&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;/code&gt; field, on the other hand is expecting a JSON object. That
missing bit will cause Javascript to blow up once this loads in the browser.&lt;/p&gt;

&lt;p&gt;What’s the solution here? In this case, I turned to &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Hash&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;#fetch&lt;/span&gt;&lt;/code&gt; rather than
the &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;&lt;/code&gt; accessor. What’s the difference? There are two main differences
between the bracket accessor and the &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;fetch&lt;/span&gt;&lt;/code&gt; method. First,
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;my_hash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:some_missing_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt; will return &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt; if the key is not found in the
hash. If &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;my_hash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:some_missing_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt; can’t find a key, it will raise a
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;KeyError&lt;/span&gt;&lt;/code&gt; exception.&lt;/p&gt;

&lt;p&gt;That’s not really what we are looking for, which brings me to the second
difference. &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Hash&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;#fetch&lt;/span&gt;&lt;/code&gt; takes an optional second argument which specifies a
default value. So if we call &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;my_hash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:some_missing_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'tacos'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt; and
the key is not found in the hash, it will return &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;s1&quot;&gt;'tacos'&lt;/span&gt;&lt;/code&gt; instead of &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;.
That’s exactly what I needed. I returned an empty JSON object &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;&lt;/code&gt; as the
default.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;gender&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;search_params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'gender'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;language&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;search_params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'language'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;query&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;search_params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'query'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;properties&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#{search_params.fetch('properties', {})}&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This degraded nicely in the cases in which I had no &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;/code&gt; hash in my
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;search_params&lt;/span&gt;&lt;/code&gt; hash.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;gender&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;M&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;27&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;language&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;query&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;specials&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                                                                                                            &lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;properties&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;No more broken Javascript.&lt;/p&gt;</content><author><name>Step Aument</name></author><category term="code" /><summary type="html">In a previous post I mentioned a case in which I had a Haml template in a Rails app with Javascript in it. The template was rendering Ruby values into what would become a JSON object (Javascript Hash) in the browser. In that particular case, a method call on a Null Object was returning nil and breaking the Javascript.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="/%7B%22credit%22=%3E%22Photo%20by%20Mitchell%20Orr%20on%20Unsplash%22,%20%22feature%22=%3E%22/assets/images/hero/mitchell-orr-389605-unsplash.jpg%22,%20%22topPosition%22=%3E%22-200px%22%7D" /></entry><entry><title type="html">The Null Object Pattern and method_missing in Ruby</title><link href="/blog/the-null-object-pattern-and-method-missing-in-ruby/" rel="alternate" type="text/html" title="The Null Object Pattern and method_missing in Ruby" /><published>2014-03-05T23:01:09-06:00</published><updated>2014-03-05T23:01:09-06:00</updated><id>/blog/the-null-object-pattern-and-method-missing-in-ruby</id><content type="html" xml:base="/blog/the-null-object-pattern-and-method-missing-in-ruby/">&lt;p&gt;I encountered an interesting problem this week that allowed me to dig into the
Null Object pattern, Ruby duck typing, and Ruby’s method_missing.&lt;/p&gt;

&lt;p&gt;In our app we have a &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; class (name changed to protect the innocent). Most
of our users have a &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; associated with their account, but some don’t. In
our application, we have certain situations which expect a Duck, even if the
user doesn’t have one. If we don’t have a Duck, but our app expects one and
passes it a message like &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;quack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/code&gt; we will receive an ugly &lt;code class=&quot;highlighter-rouge&quot;&gt;NoMethodError:
undefined method 'quack' for nil:NilClass&lt;/code&gt; error.&lt;/p&gt;

&lt;p&gt;How can we solve this without spreading smelly nil checks around our system? It
turns out there is an existing design pattern for just this situation, the Null
Object pattern. In the Null Object pattern, we create a stand in object for our
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; that can respond to the same interface, but without returning any
values. We avoid ugly &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NoMethodError&lt;/span&gt;&lt;/code&gt;s without having to check for the objects
existence everywhere.&lt;/p&gt;

&lt;p&gt;Here is our Duck:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Duck&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;awake?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'awake'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;quack&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;quack_style&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This is a Ruby on Rails ActiveRecord model, so there is more to it than we see
here. Here is the database migration file:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CreateDucks&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Migration&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;change&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;integer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hunger&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;quack_style&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;migratory&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;boolean&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;For each of these fields, ActiveRecord will create getter and setter methods in
the background. But for the &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;migratory&lt;/span&gt;&lt;/code&gt; boolean field, we will get the bonus
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;migratory?&lt;/span&gt;&lt;/code&gt; predicate method.&lt;/p&gt;

&lt;p&gt;In our case, it turned out that we need our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; to return &lt;em&gt;some&lt;/em&gt; values,
but most things should just return &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;. The simplest way for us to implement
our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt;, and the state in which I found my &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; code this week looks
something like the following:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilDuck&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;nb&quot;&gt;attr_writer&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:hunger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:quack_style&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:migratory&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Duck'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'sleeping'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;hunger&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;quack&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-19&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;quack_style&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-20&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-21&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-22&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-23&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-24&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'gray'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-25&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-26&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-27&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;awake?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-28&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-29&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-30&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-31&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-32&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-33&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-34&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-35&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-36&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-37&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-38&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Here we have provided the attribute setters our fake object needs with the
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;attr_writer&lt;/span&gt;&lt;/code&gt; call. We then proceed to override each getter as needed. There
are a few special cases in which a value other than nil is desired, but the
default return value for our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; is &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;. In the cases in which we don’t
have an actual &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; and need to use a demo &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt;, we can pass in an instance
of our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; and everything will work as expected.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Note: since Ruby is not a strongly typed language, we don’t have to subclass
our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; here or implement a formal common interface as we would in a
strongly-typed language like Java. In Rubyland, types are determined by the
public interface of the object in question. So if our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt;, or any other
object for that matter, implements the methods our client object calls in
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt;, we can substitute it. This is often called “duck typing,” since if an
object quacks like a duck, and acts like a duck, we can usually consider it a
duck. We &lt;em&gt;do&lt;/em&gt; implement a common interface, but the interface that we
implement is conceptual, represented by the messages to which we expect our
duck to respond. It’s not baked into the language as a formal construct.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;So what’s wrong with this code? Nothing at face value. Maybe it could be
refactored into something less verbose, but it’s functional and fairly
straightforward. In the beginning it served our app quite well. But I came to
this code last week because of a bug uncovered by a change in another area of
the app. It turned out that my &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; code had gotten stale and not kept up
with changes to the &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; class. Methods had been added to &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt;, but not to
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt;. Now &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; looks like this:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Duck&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;awake?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'awake'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;quack&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;quack_style&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;multi_colored?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;secondary_color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;nil?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;And the migration:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CreateDucks&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Migration&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;change&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;integer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hunger&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;quack_style&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;secondary_color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;migratory&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;boolean&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;We don’t have equivalent &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;secondary_color&lt;/span&gt;&lt;/code&gt; and  &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;multi_colored?&lt;/span&gt;&lt;/code&gt; methods and
our NilDuck started causing errors. Since none of these new methods requirs
special values, I could have just added equivalent getters in NilDuck that
returned &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;. But since I’m a lazy programmer, I asked myself how I could
avoid editing this class in the future. I turned to Ruby’s &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt;!&lt;/p&gt;

&lt;p&gt;In order to understand what my pair and I did here, you need to understand a
little about the way Ruby looks up a method, or message, passed to an object.
When you call a method on a Ruby object, Ruby first looks to see if the method
has been defined on the object instance itself (or more precisely on it’s
&lt;a href=&quot;http://en.wikipedia.org/wiki/Metaclass&quot;&gt;eigenclass&lt;/a&gt;), if it doesn’t find it it
will then look in any included modules in reverse include order, then in the
instance methods of the class, and finally in the instance methods of the
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Object&lt;/span&gt;&lt;/code&gt; class, the ultimate ancestor of every object in Ruby. If Ruby still
can’t find the method, it starts the search over at our instance, this time
trying to call &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt;. If it can’t find a definition for
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt; somewhere in our inheritance chain, only then will it throw a
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NoMethodError&lt;/span&gt;&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt; callback gives us the hook we need to handle our, well,
missing methods. Let’s refactor our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; to use &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt;:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilDuck&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Duck'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'sleeping'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'gray'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;method_missing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-19&quot;&gt;    &lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-20&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-21&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;See what we did there? We want &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; to have the same interface as &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt;,
so in our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt; implementation, we first checked to see whether
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; responds to the method our client code attempted to call. If it does, we
return &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;, otherwise we pass the buck to super. Our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; will now
respond to everything that &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; responds to and throw a &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NoMethodError&lt;/span&gt;&lt;/code&gt; for
anything that it doesn’t respond to. As a bonus, we got to eliminate a lot of
code here.&lt;/p&gt;

&lt;p&gt;But what about predicate methods? Well, in Ruby, &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt; is falsey, so this code
will work correctly in an &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/unless/&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;/code&gt; situation, but what about a situation
in which you might need &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;migratory?&lt;/span&gt;&lt;/code&gt; to explicitly give you &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;/code&gt; instead of
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;? What if you are going to pass that &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/code&gt; or &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;/code&gt; along to someone
else as a string? What if you need to feed it into javascript from an erb or
haml template?&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;multiColored&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// !!! Not a valid JSON object, buddy!&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;If this &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;duck&lt;/span&gt;&lt;/code&gt; is our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt;, &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;duck&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;multi_colored?&lt;/span&gt;&lt;/code&gt; will return &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;. When
the template is rendered and the string is interpolated, &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;’s &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;to_s&lt;/span&gt;&lt;/code&gt; method
will be invoked, which will return an empty string instead of &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;s1&quot;&gt;'false'&lt;/span&gt;&lt;/code&gt;. This
will result in a javascript error in the browser:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilDuck&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Duck'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'sleeping'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'gray'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;method_missing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-19&quot;&gt;    &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-20&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ends_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'?'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-21&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-22&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Whoops! That’s not what we wanted at all! We want &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;s1&quot;&gt;'true'&lt;/span&gt;&lt;/code&gt; or &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;s1&quot;&gt;'false'&lt;/span&gt;&lt;/code&gt; to be
rendered. How can we handle that? Well, we can fall back and explicitly create
a &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;multi_colored?&lt;/span&gt;&lt;/code&gt; method in our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; that returns &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;/code&gt;, but we can do
better than that. Let’s stay lazy so we don’t have to fix this again! Since it
turns out that we don’t really want our predicate methods to return just a
falsey value, but &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;/code&gt; itself. Let’s account for that:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilDuck&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Duck'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'sleeping'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'gray'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;method_missing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-19&quot;&gt;    &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-20&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ends_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'?'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-21&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-22&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Now if &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; responds to our method and our method ends with ‘?’, &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt;
will return &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;/code&gt;, if it doesn’t end with ‘?’ it will return &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;. Our
template will now render the javascript we expected:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;multiColored&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;You could certainly take this further and abstract out a generic &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt;
for your app, but this serves our needs quite well. For further reading on the
Null Object pattern:
&lt;a href=&quot;http://devblog.avdi.org/2011/05/30/null-objects-and-falsiness/&quot;&gt;http://devblog.avdi.org/2011/05/30/null-objects-and-falsiness/&lt;/a&gt;&lt;/p&gt;</content><author><name>Step Aument</name></author><summary type="html">I encountered an interesting problem this week that allowed me to dig into the Null Object pattern, Ruby duck typing, and Ruby’s method_missing.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="/%7B%22credit%22=%3E%22Photo%20by%20Braydon%20Anderson%20on%20Unsplash%22,%20%22feature%22=%3E%22/assets/images/hero/braydon-anderson-105552-unsplash.jpg%22,%20%22topPosition%22=%3E%22-420px%22%7D" /></entry></feed>