<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.5">Jekyll</generator><link href="https://www.stephenaument.com/feed.xml" rel="self" type="application/atom+xml" /><link href="https://www.stephenaument.com/" rel="alternate" type="text/html" /><updated>2020-05-10T19:20:51-05:00</updated><id>https://www.stephenaument.com/feed.xml</id><title type="html">Stephen Aument</title><subtitle>Compassionate Coder. Technical Leader.</subtitle><author><name>Stephen Aument</name></author><entry><title type="html">Are You Still Feeling Overwhelmed With Your Backlog?</title><link href="https://www.stephenaument.com/blog/ruthless-stack-ranking/" rel="alternate" type="text/html" title="Are You Still Feeling Overwhelmed With Your Backlog?" /><published>2019-03-21T00:00:00-05:00</published><updated>2019-03-21T00:00:00-05:00</updated><id>https://www.stephenaument.com/blog/ruthless-stack-ranking</id><content type="html" xml:base="https://www.stephenaument.com/blog/ruthless-stack-ranking/">&lt;h1 id=&quot;ruthlessly-stack-rank-your-people-priorities&quot;&gt;Ruthlessly Stack Rank Your &lt;del&gt;People&lt;/del&gt; Priorities&lt;/h1&gt;

&lt;blockquote class=&quot;largeQuote&quot;&gt; “The mark of a great man is one who knows when to set aside the important things in order to accomplish the vital ones.” 
― Brandon Sanderson, &lt;em&gt;The Alloy of Law&lt;/em&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;em&gt;The Long Dark&lt;/em&gt; is a challenging survival game from Hinterland Games that places you in remote northern Canada during winter with few resources.  One thing &lt;em&gt;The Long Dark&lt;/em&gt; does that other games don’t tend to bother with is a realistic-ish (realistish?) inventory system. Every item has weight, and based on a variety of factors you can only carry a certain weight before it starts to affect your speed and stamina.&lt;/p&gt;

&lt;p&gt;It’s not a wooden literalism, but it has the “feel” of reality. I remember running around in the &lt;em&gt;Half Life&lt;/em&gt; series with what would have been thousands of pounds of gear that would have filled a large truck, not to mention what you can fit in your &lt;em&gt;Minecraft&lt;/em&gt; inventory. But you won’t get away with that claptrap here.&lt;/p&gt;

&lt;p&gt;This inventory system forces you to make hard choices about what to pick up and what to drop. Can I afford to pick up this log now? How much meat should I harvest from this deer carcass?&lt;/p&gt;

&lt;p&gt;You are not always choosing between valuable items and junk. Sometimes you have to leave good items behind, and it hurts.&lt;/p&gt;

&lt;h2 id=&quot;the-concept&quot;&gt;The Concept&lt;/h2&gt;

&lt;p&gt;I’ve become associated around &lt;a href=&quot;https://www.readyrosie.com&quot;&gt;ReadyRosie&lt;/a&gt; with the concept of ruthlessly stack-ranking priorities.&lt;/p&gt;

&lt;p&gt;What is stack ranking? Stack ranking is simply sorting a list of items 1-N.&lt;/p&gt;

&lt;p&gt;Some other prioritization systems have you group tasks into buckets, A, B, C, etc. Stack ranking forces you to choose which of any 2 items is more important.&lt;/p&gt;

&lt;p&gt;Note: This is a &lt;em&gt;terrible&lt;/em&gt; idea when it comes to people (please don’t stack rank your people!), but it works &lt;em&gt;brilliantly&lt;/em&gt;  when it comes to prioritizing work.&lt;/p&gt;

&lt;h2 id=&quot;lol-why-do-you-do-this&quot;&gt;LOL, Why Do You Do This?&lt;/h2&gt;

&lt;p&gt;We are a small team at &lt;a href=&quot;https://www.readyrosie.com&quot;&gt;ReadyRosie&lt;/a&gt;. There will always be more than we can do. We will never get to the bottom of our backlog. Sound familiar?&lt;/p&gt;

&lt;p&gt;And, we are never choosing between adding deep value and adding fluff. Just like in &lt;em&gt;The Long Dark&lt;/em&gt;, every day we have to choose between valuable options. Which good things are we not going to do this sprint so we can focus on these other things that have edged them out?&lt;/p&gt;

&lt;p&gt;Does this sound familiar? Too much to do, not enough time.&lt;/p&gt;

&lt;p&gt;So, we stack rank.&lt;/p&gt;

&lt;h2 id=&quot;the-method&quot;&gt;The Method&lt;/h2&gt;

&lt;p&gt;We get all stakeholders together in a (virtual) room, often in real time, and hash it out. We’ve done it by sorting the list, one item at a time. We’ve done it by assigning numbers 0-100 and then sorting based on those numbers. We’ve done it as one group. We’ve done it in several cross-functional teams.&lt;/p&gt;

&lt;p&gt;Whichever way, the most important thing is that the top 5-10 items are what we have identified as the &lt;em&gt;most important&lt;/em&gt; things we could be doing, &lt;em&gt;in that order.&lt;/em&gt; Then if we work from the top down, we can know that what we are doing is what we &lt;em&gt;should&lt;/em&gt; be doing, because it meets our definition of doing the most important thing we &lt;em&gt;could&lt;/em&gt; be doing.&lt;/p&gt;

&lt;p&gt;It’s the same for individual projects or features. We’re learning to be iterative in our product development and optimize for learning in tight feedback loops by putting working software in our customers hands as quickly as we can. But sometimes somebody has been chewing on a project idea for a while.&lt;/p&gt;

&lt;p&gt;We have gifted subject matter experts who have been in the classroom and know our customers and their pains well. They are thoughtful. They listen. They are creative. Often, they have a pretty well developed idea of a complete solution to a problem. One that would take months to implement and be a huge gamble. Is that complete solution the right solution? Maybe. Can we afford months of development time before actually getting valuable feedback that tells us if it’s the right solution? Absolutely not.&lt;/p&gt;

&lt;p&gt;The reality is that we will never know less about our customers or our product than we know today. The reality is that we will learn so much over the next few sprints that those items further down the list will change a lot, or go away altogether.&lt;/p&gt;

&lt;h2 id=&quot;what-about-dates&quot;&gt;What About Dates?&lt;/h2&gt;

&lt;p&gt;Sometimes there is an actual important date somewhere on our calendar. It’s rarer than you would think, but it happens. When it does happen that something actually needs to happen by a certain date, that makes it more important than something that doesn’t need to happen by a date (or by a later date). Do the date-bound thing first. Do it &lt;em&gt;now&lt;/em&gt;.&lt;/p&gt;

&lt;h2 id=&quot;crushing-hopes-and-dreams---a-dramatic-recreation&quot;&gt;Crushing Hopes and Dreams - A Dramatic Recreation&lt;/h2&gt;

&lt;p&gt;I’ve led groups through the exercise of stack ranking the precious, well thought-out features of their solution and the conversation goes something like this:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;INT. CONFERENCE ROOM. DAY

STEP and a PRODUCT OWNER/SUBJECT MATTER EXPERT stand at the whiteboard. A group of PostIt
notes representing product features covers one side of the whiteboard.

                        STEP

          If we could do one thing this sprint. What’s the most important
          piece of this that would add value to our customers while also
          giving us the best feedback so we can learn the most? What
          would it be?

                        PRODUCT OWNER/SUBJECT MATTER EXPERT

          One??? Can I have five things?

                        STEP

          We only have time for one.

                        PRODUCT OWNER/SUBJECT MATTER EXPERT

          I guess it would be this one.

                        STEP

          Perfect. Oh, hey. I just found out we have room for one more.

                        PRODUCT OWNER/SUBJECT MATTER EXPERT

          Then we should add this one.

                        STEP

          You know what? We have time for one more feature.

                        PRODUCT OWNER/SUBJECT MATTER EXPERT

          Well, the next three really go together.

                        STEP

          There is room for three total, and I’m not sure we will ever
          do any more work on this project again after this sprint.

                        PRODUCT OWNER/SUBJECT MATTER EXPERT

          I hate you, Step. But if I have to choose, it’s this one.

FADE TO BLACK

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;so-what&quot;&gt;So What?&lt;/h2&gt;

&lt;p&gt;In the end, you wind up with the most important things at the top of the list.
 And actually, it’s been a long time since we’ve had to argue through a long, pre-planned project like that. We are learning to do lean, iterative product development together as a whole team. We are figuring out what “agile” and “lean” mean here at &lt;a href=&quot;https://www.readyrosie.com&quot;&gt;ReadyRosie&lt;/a&gt;, and it’s not exactly what it means anywhere else. Just as it should be.&lt;/p&gt;

&lt;p&gt;What “important” means in your context is an entirely different question, and learning to make those decisions is another skill to develop. But if you prioritize this way and actually work from the top of your list downward, then a lot of things just fall into place.&lt;/p&gt;

&lt;p&gt;Did your day get away from you in the afternoon? Only get to work on one thing? That’s okay, because that one thing that you worked on was the most important thing. What else can you ask for?&lt;/p&gt;</content><author><name>Step Aument</name></author><summary type="html">Ruthlessly Stack Rank Your People Priorities</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://www.stephenaument.com/%7B%22feature%22=%3E%22/assets/images/hero/the-long-dark.jpg%22,%20%22topPosition%22=%3E%22-220px%22%7D" /></entry><entry><title type="html">Lead with Value. Be Generous.</title><link href="https://www.stephenaument.com/blog/lead-with-value-be-generous/" rel="alternate" type="text/html" title="Lead with Value. Be Generous." /><published>2019-03-13T00:00:00-05:00</published><updated>2019-03-13T00:00:00-05:00</updated><id>https://www.stephenaument.com/blog/lead-with-value-be-generous</id><content type="html" xml:base="https://www.stephenaument.com/blog/lead-with-value-be-generous/">&lt;style&gt;
  ul {
    list-style-type: unset;
    margin: 2em;
    padding: unset;
  }
&lt;/style&gt;

&lt;h2 id=&quot;lead-with-value-be-generous&quot;&gt;Lead with Value. Be Generous.&lt;/h2&gt;

&lt;p&gt;Redditor &lt;a href=&quot;https://www.reddit.com/user/programmingerror&quot;&gt;programmingerror&lt;/a&gt;, aka Sam Zhao recently wrote a helpful post about value as it relates to the job hunt as a programmer, which he also posted on his &lt;a href=&quot;https://ilovecomputering.com/the-most-important-thing-to-understand-in-job-searching-value/&quot;&gt;blog&lt;/a&gt;. There is also a principle in entrepreneurship that you find success in proportion to the value that you create.&lt;/p&gt;

&lt;blockquote class=&quot;largeQuote&quot;&gt;“You can get everything in life you want if you will just help enough other people get what they want.” - Zig Ziglar&lt;/blockquote&gt;

&lt;p&gt;And really, that’s the fundamental reality of all financial transactions (aside from pure charity). Even if you are a salaried employee. Even if you are flipping burgers for an hourly wage. You are not being paid for your time. You are being paid for the value that you create. It is worth $X an hour for the manager to hire you to flip that burger so she doesn’t have to do it herself. I buy your product because it saves me $X worth of time or money, or makes me $X and you are charging me less than that.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;”Strive not to be a success, but rather to be of value.” - Albert Einstein&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;If you want to level up your earning potential and/or advance in your career, what can you do? &lt;strong&gt;Increase your value-creating abilities.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;But this doesn’t just equal leveling up your skills. You have to know how skills actually translate to (or scaffold towards) value-creating abilities. Which skills do you learn?&lt;/p&gt;

&lt;p&gt;There are lots of lists out there of top skills for software developers to learn. Some of them focus on new trends that will keep you on the cusp of high-paying technical work. I won’t poo-poo these lists. It’s important to keep your tools sharp and, by all means, get a better paying job this year if you can. But I want to take a different approach here.
 I’m going to focus on more enduring skills that will serve you no matter what language or framework you work with and will actually help you into the middle and late stages of your career, help you move from individual contributor to leader, or even help you transition from employee to entrepreneur if that’s something you’d like to do.&lt;/p&gt;

&lt;p&gt;Most of these are what we call “soft skills.”&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;listening&lt;/li&gt;
  &lt;li&gt;idea/pain discovery&lt;/li&gt;
  &lt;li&gt;problem solving&lt;/li&gt;
  &lt;li&gt;empathy&lt;/li&gt;
  &lt;li&gt;writing maintainable code&lt;/li&gt;
  &lt;li&gt;prioritization&lt;/li&gt;
  &lt;li&gt;showing up&lt;/li&gt;
  &lt;li&gt;following through&lt;/li&gt;
  &lt;li&gt;shipping&lt;/li&gt;
  &lt;li&gt;doing small things&lt;/li&gt;
  &lt;li&gt;optimizing for learning at every level&lt;/li&gt;
  &lt;li&gt;go deep on one thing&lt;/li&gt;
  &lt;li&gt;when in doubt, ship and measure&lt;/li&gt;
  &lt;li&gt;developing a growth mindset if you don’t have one&lt;/li&gt;
  &lt;li&gt;maintaining an optimistic outlook&lt;/li&gt;
  &lt;li&gt;assuming the best intentions in others&lt;/li&gt;
  &lt;li&gt;writing&lt;/li&gt;
  &lt;li&gt;selling/marketing&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote class=&quot;largeQuote&quot;&gt;One person gives freely, yet gains even more;  another withholds unduly, but comes to poverty. A generous person will prosper;  whoever refreshes others will be refreshed.  - Proverbs 11:24–25&lt;/blockquote&gt;

&lt;p&gt;Don’t focus on getting what you think you deserve to earn. Develop the ability to deliver the value commensurate to what you hope to earn.&lt;/p&gt;

&lt;p&gt;Figure out how to deliver value, and as Sam points out, communicate that you bring that value. Lead with providing value and then figure out how to make money as a result of that. If you can make somebody $10 do you think they will be willing to give you $1 or $2? How many times would they be willing to sign up for that? Or as I heard somebody put it once, if you give me a pizza that I wouldn’t have had otherwise, I will happily give you a slice of it.&lt;/p&gt;

&lt;p&gt;Go forth and add value to your world.&lt;/p&gt;</content><author><name>Step Aument</name></author><summary type="html"></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://www.stephenaument.com/%7B%22credit%22=%3E%22Photo%20by%20Elaine%20Casap%20on%20Unsplash%22,%20%22feature%22=%3E%22/assets/images/hero/elaine-casap-86020-unsplash.jpg%22,%20%22topPosition%22=%3E%22-180px%22%7D" /></entry><entry><title type="html">Exercism.io Walkthrough Screencasts</title><link href="https://www.stephenaument.com/blog/exercism-io-walkthrough/" rel="alternate" type="text/html" title="Exercism.io Walkthrough Screencasts" /><published>2019-02-26T00:00:00-06:00</published><updated>2019-02-26T00:00:00-06:00</updated><id>https://www.stephenaument.com/blog/exercism-io-walkthrough</id><content type="html" xml:base="https://www.stephenaument.com/blog/exercism-io-walkthrough/">&lt;h2 id=&quot;exercismio-walkthrough-screencast-series&quot;&gt;Exercism.io Walkthrough Screencast Series&lt;/h2&gt;

&lt;p&gt;I’m experimenting with a screencast series on YouTube walking through the &lt;a href=&quot;https://exercism.io&quot;&gt;exercism.io&lt;/a&gt; Ruby track.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;If you want to be notified when new episodes get posted to YouTube &lt;a href=&quot;#subscribe&quot;&gt;subscribe down below&lt;/a&gt; and grab a helpful cheatsheet while you are at it.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Before I got to do a lot of pairing with other experienced devs I always wished I could watch more people just code. I didn’t have a great sense of how other people went about their work or if my methods were weird or normal. This was especially true early on. It’s one thing to follow a tutorial, but I just wanted to see somebody code.&lt;/p&gt;

&lt;p&gt;I’m certainly not the first person to post exercism.io walkthroughs, but my assumption is that one more example of a working developer’s workflow and thought process is a good thing.&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/videoseries?list=PLJQ6Wm449IcFAoewLSqKYyVn3ODsrcrMj&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;p&gt;I’m also trying to think of creative ways to coach my team more effectively. My schedule doesn’t always allow large blocks of pairing, but I can find time to record and post a screencast. These videos will hopefully be useful for them.&lt;/p&gt;

&lt;p&gt;My plan is to do handful of these and then promote them a bit to see if they are as helpful as I hope they will be. If you watch them and find them helpful, drop me a note or leave a comment.&lt;/p&gt;

&lt;p&gt;UPDATE: I’ve packaged the first group of these into a FREE video email course that I’m calling, &lt;a href=&quot;/10dotr/index.html&quot;&gt;&lt;em&gt;10 Days of Tactical Ruby With Exercism.io&lt;/em&gt;&lt;/a&gt;. &lt;a href=&quot;/10dotr/index.html&quot;&gt;Go here to enroll.&lt;/a&gt;&lt;/p&gt;</content><author><name>Step Aument</name></author><summary type="html">Exercism.io Walkthrough Screencast Series</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://www.stephenaument.com/%7B%22feature%22=%3E%22/assets/images/hero/exercism-io.png%22,%20%22topPosition%22=%3E%22-180px%22%7D" /></entry><entry><title type="html">Underpromise. Overdeliver.</title><link href="https://www.stephenaument.com/blog/underpromise-overdeliver/" rel="alternate" type="text/html" title="Underpromise. Overdeliver." /><published>2018-09-28T00:00:00-05:00</published><updated>2018-09-28T00:00:00-05:00</updated><id>https://www.stephenaument.com/blog/underpromise-overdeliver</id><content type="html" xml:base="https://www.stephenaument.com/blog/underpromise-overdeliver/">&lt;h2 id=&quot;always-provide-fanatical-customer-service&quot;&gt;Always Provide Fanatical Customer Service&lt;/h2&gt;

&lt;p&gt;Faber-Castell has blown my mind with fanatical customer service that embodies the principle, “underpromise and overdeliver”.&lt;/p&gt;

&lt;p&gt;I’ve had fountain pens off and on since high school. Mostly disposable pens that didn’t write particularly well. My first real pen was a Pelikan classic. I don’t exactly remember the model. That was the pen with which I really learned to use and care for a fountain pen. Unfortunately, as learning goes, I wasn’t really ready for that pen. I cracked the lid through some carelessness and from that point on the ink would dry out too quickly to be useful anymore. I held on to it as a souvenir, but it got lost in a move at some point.&lt;/p&gt;

&lt;p&gt;My wife gave me a Faber-Castell Ambition fountain pen in pearwood for my birthday 8 years ago. It’s a beautiful pen. I had been admiring it at &lt;a href=&quot;http://paper-ya.com/&quot;&gt;Paper Ya&lt;/a&gt; on Granville Island in Vancouver for months. It was sleek and architectural. Modern. I loved the straight lines. The narrowness of the barrel. The color of the wood. The weight. That pen immediately became my daily carry pen.&lt;/p&gt;

&lt;p&gt;What we didn’t realize at the time was that it would be our last year in Vancouver. We came home to Texas the following summer to be closer to our aging parents. That pen became a token of our time there. It took on the added weight of tying me to a city that I loved and missed.&lt;/p&gt;

&lt;p&gt;In the last three or so years, the cap became loose. Eventually it would fall off under its own weight. At the same time, the inner core of the pen became detached from the barrel and would slide back and forth. For fear of losing the cap, I stopped carrying it.&lt;/p&gt;

&lt;p&gt;Finally, after googling around for options to fix the cap, I decided to email Faber-Castell customer support. I asked them about repairs or parts. I received the following email in reply:&lt;/p&gt;

&lt;blockquote&gt;
Dear Mr. Aument:

Thank you for your interest in Faber-Castell and the Design Brand.

Thank you for your interest in Faber-Castell. I am sorry to hear that you are experiencing a problem with your instrument. If you are located in the U.S. (only), and to ensure proper fit and function, please send the entire instrument along to the address listed below for assessment/repairs. 
 
Address:
Faber-Castell USA
Attn: Repairs
9450 Allen Drive, Ste. B
Cleveland, OH  44125
 
Repairs should be sent in a protected, traceable fashion as Faber-Castell is not responsible for items lost or damaged prior to receipt.

- Please include a note indicating what the problem is exactly and, within the note, include your return shipping address and daytime phone number/email address.  
- Empty all fountain pens of ink.  
- Do not send original gift packaging.  
- Do not tape or glue parts together.  
 
Once your instrument has been received and assessed we will contact you with the charges will apply, prior to the start of the actual repair work. All estimates are provided by phone, but I can tell you that it would be no more than $30. 
 
Please let me know if I can assist any further as I will surely do my best to help.

Sincerely,
 
Michelle ******
Consumer Relations Specialist
&lt;/blockquote&gt;

&lt;p&gt;That seemed fair to me! I shipped off the pen and awaited my estimate.&lt;/p&gt;

&lt;p&gt;After a couple of weeks, I received a shipping notification(!) and the following voicemail.&lt;/p&gt;

&lt;blockquote&gt;
Hi Mr. Aument, this is Michelle with Faber-Castell. Just calling to let you know we received your Ambition Pearwood. I wanted to let you know that actually the nib is the issue. Obviously your barrel, there's bonding on the barrel and we are going to be replacing the barrel. The issue with the cap, the cap is actually fine. It's the nib that is not seated properly. Given that we're already going to be replacing the barrel, I'm just going to go ahead and replace the pen since there's also issues with the nib. That's going to be shipping out to you most likely on Monday to your PO Box XXX. So it'll just be an entirely new pen. I did want to let you know that in general the warranty for the design brand is two years for manufacturer's defect. I know you had said this was eight years. So just keep that in mind for the replacement. And then like I said, if you ever have any follow-up questions, feel free to give us a call 1-800-311-8064. Thank you.
&lt;/blockquote&gt;

&lt;p&gt;Wow! Now &lt;em&gt;that’s&lt;/em&gt; customer service! I had zero expectation of this. I was perfectly willing to pay &lt;em&gt;something&lt;/em&gt; to have my beloved pen back in working order, but this was above and beyond.&lt;/p&gt;

&lt;p&gt;Anyway, I went to the post office to pick up the pen today and and when I opened the package - double wow!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/posts/faber-castell-package.jpg&quot; alt=&quot;package-contents&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Look at that!&lt;/p&gt;

&lt;p&gt;Nice handwritten postcard. Bonus pencil.&lt;/p&gt;

&lt;p&gt;“But,” you say, “this wasn’t altruistic. They do this for everybody. It’s marketing. Plus they sent you a sample pencil so you’ll want to buy those.”&lt;/p&gt;

&lt;p&gt;Well, duh. Of course. But they also didn’t &lt;em&gt;have&lt;/em&gt; to do this. I &lt;em&gt;know&lt;/em&gt; there’s self interest in this, but do you know how it made me feel? It made me feel important. It made me feel lavishly taken care of.&lt;/p&gt;

&lt;blockquote class=&quot;largeQuote&quot;&gt;
&quot;There is a spiritual aspect to our lives — when we give, we receive — when a business does something good for somebody, that somebody feels good about them!&quot; - Ben Cohen, Co-Founder Ben &amp;amp; Jerry's&lt;/blockquote&gt;

&lt;p&gt;This fanatical customer service was a case of “underpromise and overdeliver.” They promised me a repair estimate that would likely be under $30. They delivered a brand new replacement pen at their cost, a hand-written note, and a free bonus gift.&lt;/p&gt;

&lt;p&gt;Faber-Castell has been in business since 1761. &lt;em&gt;1761!&lt;/em&gt; That’s 257 years! I would have to assume that they have learned some things during that time about staying in business.&lt;/p&gt;

&lt;p&gt;Often in business it’s not the hard things that make the most difference. It’s the little things that show our customers that we care about them and that we are here to serve them. When we lead with service and make it our intent to only make money by having served others &lt;em&gt;first&lt;/em&gt; we earn loyal customers. Even if they might not make better pens than every competitor (which they might, I’m just saying), they &lt;em&gt;can&lt;/em&gt; strive to provide better customer service than anyone else.&lt;/p&gt;

&lt;p&gt;And so can &lt;em&gt;you&lt;/em&gt;. Can you out serve your competitors in this way? Even if you’re just getting your startup off the ground? Can you provide fanatical service to your customers, whether your customers be outside or internal to your organization?&lt;/p&gt;

&lt;p&gt;Thank you, Michelle at Faber-Castell Consumer Relations!&lt;/p&gt;

&lt;p&gt;I already loved this Faber-Castell pen. After today, I love Faber-Castell, the company too. And I haven’t stopped telling people about their fanatical customer support.&lt;/p&gt;

&lt;p&gt;I feel like we provide fanatical customer support at ReadyRosie (hi Hilari!), but what a stunning reminder.&lt;/p&gt;

&lt;p&gt;So, I’m sad that this isn’t &lt;em&gt;that&lt;/em&gt; pen. It’s a replacement. But it’s lovely and new and it can stand in for &lt;em&gt;that&lt;/em&gt; pen. But now, not only does it serve to remind me of my wife, a special gift, and a city I miss, it also reminds me to always underpromise and overdeliver and to always provide fanatical customer service.&lt;/p&gt;</content><author><name>Step Aument</name></author><summary type="html">Always Provide Fanatical Customer Service</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://www.stephenaument.com/%7B%22feature%22=%3E%22/assets/images/hero/ambition-pearwood.jpg%22,%20%22topPosition%22=%3E%22-180px%22%7D" /></entry><entry><title type="html">Backbone Collection Testing Gotcha</title><link href="https://www.stephenaument.com/blog/backbone-collection-testing-gotcha/" rel="alternate" type="text/html" title="Backbone Collection Testing Gotcha" /><published>2014-03-12T16:46:04-05:00</published><updated>2014-03-12T16:46:04-05:00</updated><id>https://www.stephenaument.com/blog/backbone-collection-testing-gotcha</id><content type="html" xml:base="https://www.stephenaument.com/blog/backbone-collection-testing-gotcha/">&lt;p&gt;Be careful of this gotcha when testing a &lt;a href=&quot;http://backbonejs.org/&quot;&gt;Backbone.js&lt;/a&gt;
collection. I don’t have much experience with Backbone, so this is probably
obvious to more experienced users, but hopefully this will help somebody else,
or at least myself in the future.&lt;/p&gt;

&lt;p&gt;Today I needed to test the behavior of a Collection with a certain number of
Models in it. I didn’t care about the content of the models, just that they
contained a certain field. So, my pair and I came up with this setup to run
in our &lt;a href=&quot;http://jasmine.github.io/&quot;&gt;Jasmine&lt;/a&gt; specs:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;nx&quot;&gt;provider&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WellMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;display_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'a'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;&lt;span class=&quot;nx&quot;&gt;providerArray&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;provider&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;&lt;span class=&quot;nx&quot;&gt;providers&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WellMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Collections&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Providers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;providerArray&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;We created an array of dummy models and passed them into our Collection. This
is one way you can create and populate a Collection. You pass in your array of
models and they become the models in the Collection.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;If that &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;providerArray&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;provider&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;&lt;/code&gt; syntax freaks you out, don’t
worry. It’s just a bit of fancy CoffeeScript and all you need to understand
for now is that it creates an 18 item array with each element being
&lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;provider&lt;/span&gt;&lt;/code&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Makes sense, right? Well, our test failed and when we started debugging in the
browser, here’s what we saw:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;nx&quot;&gt;Providers&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;fullParams&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_byId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_events&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;…&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;What??? &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt;? When we looked into the models array it
contained a single item from the array we passed in.&lt;/p&gt;

&lt;p&gt;Next we tried setting the models array after the fact:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;nx&quot;&gt;provider&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WellMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;display_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'a'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;&lt;span class=&quot;nx&quot;&gt;providers&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WellMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Collections&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Providers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;&lt;span class=&quot;nx&quot;&gt;providers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;providerArray&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The models array seems right now, but the collection length was still one:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;nx&quot;&gt;Providers&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;fullParams&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_byId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_events&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Object&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;…&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This was just as baffling. By this time we had called in &lt;a href=&quot;@timtyrrell&quot;&gt;Tim
Tyrell&lt;/a&gt; to tell us what we were doing wrong. Tim had the foresight
to read, not just the docs for the Backbone Collection &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;initializer&lt;/span&gt;&lt;/code&gt; method, but
also the documentation for the &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;add&lt;/span&gt;&lt;/code&gt; method, which had this to say (emphasis
added):&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;em&gt;If you’re adding models to the collection that are already in the collection,
they’ll be ignored&lt;/em&gt;, unless you pass {merge: true}, in which case their
attributes will be merged into the corresponding models, firing any
appropriate “change” events.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Interesting! When add is called, it ignores any objects that are already
present in the models array. Since we are using the same model instance in each
position of our array, only the first one is being stored. The rest are being
dumped.&lt;/p&gt;

&lt;p&gt;A quick check of the &lt;a href=&quot;https://github.com/jashkenas/backbone/blob/master/backbone.js#L785-L799&quot;&gt;Backbone source
code&lt;/a&gt;
confirms that the initialize method is calling &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;reset&lt;/span&gt;&lt;/code&gt; with the array you pass
in, which iterates over the array and calls &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;add&lt;/span&gt;&lt;/code&gt; for each.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;cm&quot;&gt;/* Excerpt starting at line 785 */&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// When you have more items than you want to add or remove individually,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// you can reset the entire set with a new list of models, without firing&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// any granular &amp;lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&amp;gt;&amp;lt;span class=&quot;nx&quot;&amp;gt;add&amp;lt;/span&amp;gt;&amp;lt;/code&amp;gt; or &amp;lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&amp;gt;&amp;lt;span class=&quot;nx&quot;&amp;gt;remove&amp;lt;/span&amp;gt;&amp;lt;/code&amp;gt; events. Fires &amp;lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&amp;gt;&amp;lt;span class=&quot;nx&quot;&amp;gt;reset&amp;lt;/span&amp;gt;&amp;lt;/code&amp;gt; when finished.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// Useful for bulk operations and optimizations.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;&lt;span class=&quot;nx&quot;&gt;reset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{});&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_removeReference&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;previousModels&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;  &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_reset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;silent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;silent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;trigger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'reset'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;So, my pair, Curtis Ekstrom decided to try creating a new object for each
element of the array with the same data to see if that would work.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;nx&quot;&gt;providerArray&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WellMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Provider&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;display_name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'a'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;&lt;span class=&quot;nx&quot;&gt;providers&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WellMatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Collections&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Providers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;providerArray&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;And so it did. At first I thought that Backbone was performing a simple object
identity check (===) vs an equality check (==). That would make sense of the
behavior we saw, but when I read the &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;add&lt;/span&gt;&lt;/code&gt; documentation again, I saw that
passing &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nl&quot;&gt;merge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt; along with the model or model array would result in the
attributes passed in being merged into the existing objects. It must be doing
something else entirely.&lt;/p&gt;

&lt;p&gt;Another peek into the &lt;a href=&quot;https://github.com/jashkenas/backbone/blob/master/backbone.js#L718-L728&quot;&gt;source
code&lt;/a&gt;
confirms. &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;add&lt;/span&gt;&lt;/code&gt; calls &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;kd&quot;&gt;set&lt;/span&gt;&lt;/code&gt;, which contains the relevant:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;cm&quot;&gt;/* Except starting at line 718 */&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// If a duplicate is found, prevent it from being added and&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;&lt;span class=&quot;c1&quot;&gt;// optionally merge it into the existing model.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;existing&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;modelMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;existing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;cid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;merge&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;    &lt;span class=&quot;nx&quot;&gt;attrs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;attrs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;model&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attributes&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;attrs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;attrs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;existing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attrs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;    &lt;span class=&quot;nx&quot;&gt;existing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;attrs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;sortable&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;sort&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;existing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;hasChanged&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;sortAttr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sort&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;  &lt;span class=&quot;nx&quot;&gt;models&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;existing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;That first line &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;existing&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/code&gt; is the key. It looks for an
existing model in the &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;_byId&lt;/span&gt;&lt;/code&gt; object hash, with the same &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;&lt;/code&gt;, &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;cid&lt;/span&gt;&lt;/code&gt; or that is the
object itself. If it finds it, and &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;nx&quot;&gt;merge&lt;/span&gt;&lt;/code&gt; is not &lt;code class=&quot;highlight language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;/code&gt; it rejects the model.&lt;/p&gt;

&lt;p&gt;TL;DR - Make sure each Model in the array you pass to the Collection
initializer is a distinct instance, even if the data is otherwise identincal.&lt;/p&gt;</content><author><name>Step Aument</name></author><category term="code" /><summary type="html">Be careful of this gotcha when testing a Backbone.js collection.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://www.stephenaument.com/%7B%22credit%22=%3E%22Photo%20by%20Anita%20Jankovic%20on%20Unsplash%22,%20%22feature%22=%3E%22/assets/images/hero/anita-jankovic-730367-unsplash.jpg%22,%20%22topPosition%22=%3E%22-200px%22%7D" /></entry><entry><title type="html">Null Object Part 2</title><link href="https://www.stephenaument.com/blog/null-object-part-2/" rel="alternate" type="text/html" title="Null Object Part 2" /><published>2014-03-11T01:00:00-05:00</published><updated>2014-03-11T01:00:00-05:00</updated><id>https://www.stephenaument.com/blog/null-object-part-2</id><content type="html" xml:base="https://www.stephenaument.com/blog/null-object-part-2/">&lt;p&gt;In a &lt;a href=&quot;/blog/2014/03/05/the-null-object-pattern-and-method-missing-in-ruby/&quot;&gt;previous post&lt;/a&gt; I
described using &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt; in a Null Object to stand in for another
object and respond smartly to the original object’s interface. At the end of
that post I suggested that you could go farther than we did in creating a more
abstract object. Well, we got that chance.&lt;/p&gt;

&lt;p&gt;In this post I will show you how we created a &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt; that can both stand
on its own and be extended with added functionality in a subclass. Our
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt; needs to be smart about the interface of the class that it’s
faking, so we’ll have to take that into account. Finally, we decided to
implement a smart &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;respond_to?&lt;/span&gt;&lt;/code&gt; method to round out the functionality of our
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Here’s the form that our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; took at the end of the previous post:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilDuck&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Duck'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'sleeping'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'gray'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;method_missing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-19&quot;&gt;    &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-20&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ends_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'?'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-21&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-22&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;A few days after making those changes, we ran into another custom Null Object
in our app, the &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilGoose&lt;/span&gt;&lt;/code&gt;. Our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilGoose&lt;/span&gt;&lt;/code&gt; ran into the
same problem that &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; originally did. A new method was added to the
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Goose&lt;/span&gt;&lt;/code&gt; class that wasn’t reflected in &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilGoose&lt;/span&gt;&lt;/code&gt; and a bug appeared.&lt;/p&gt;

&lt;p&gt;What to do? Well, we try not to run ahead of ourselves or our tests, so the
first thing we did was create a test that expected the missing method, watched
it fail, and copied the &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt; definition from &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt;, renaming as
we needed to.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilGoose&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Goose'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'awake'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'black'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;method_missing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-19&quot;&gt;    &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Goose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-20&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ends_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'?'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-21&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This made our test happy. But the duplicated code made us sad. We like
&lt;a href=&quot;http://en.wikipedia.org/wiki/Don't_repeat_yourself&quot;&gt;DRY&lt;/a&gt; code around here. We
knew it was time to factor out our common code into a single spot.&lt;/p&gt;

&lt;p&gt;We thought about putting it in a Module that could be included into other
special null objects, but decided instead to make it a full-fledged &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt;
class that we could use standalone as well as a superclass for our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt;
and &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilGoose&lt;/span&gt;&lt;/code&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilObject&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;klass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;vi&quot;&gt;@klass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;klass&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;method_missing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@klass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ends_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'?'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;If you recall in our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt; implementation, we had to new up an
instance of our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; class to determine whether it responds to the method we
are testing. Since we want to reuse this method in the generic &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt;, we
won’t know which class to check. Our first pass at a solution requires the
class to be passed into the &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt; constructor, which would look like
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;faker&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;In our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;initialize&lt;/span&gt;&lt;/code&gt; method we save the class passed in into an instance
variable, &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;vi&quot;&gt;@klass&lt;/span&gt;&lt;/code&gt;, which &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt; then uses to new up an instance to
check. Now we can fake any class we want with our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt;, and it will
handle exactly those methods the subject responds to and no others. (Note: If
you’re weirded out by passing a class around like that, remember that
everything in Ruby is an object, including classes)&lt;/p&gt;

&lt;p&gt;Now we can make &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; inherit from &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt;:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilDuck&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Duck'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'sleeping'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'gray'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;and the same for &lt;code class=&quot;highlighter-rouge&quot;&gt;NilGoose&lt;/code&gt;:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilGoose&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Goose'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'awake'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'black'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This is all very cool, but if I leave the code like this I’m going to have to
run around and find every place in the app in which I create an instance of
&lt;code class=&quot;highlighter-rouge&quot;&gt;NilDuck&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;NilGoose&lt;/code&gt; and add the new argument. Hopefully it’s not very many
places, but this is not something I want to do. Let’s go ahead and add
initialize methods to our &lt;code class=&quot;highlighter-rouge&quot;&gt;NilDuck&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;NilGoose&lt;/code&gt; classes to take care of
that:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilDuck&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initialize&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Duck'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'sleeping'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'gray'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-19&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-20&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-21&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilGoose&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initialize&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Goose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Goose'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'awake'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'black'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-19&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-20&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-21&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;That works, and it keeps us from having to spread changes around the codebase,
but it does add to the duplication a bit. That initialize method needs to be
added to every new subclass in order to get the shorter &lt;code class=&quot;highlighter-rouge&quot;&gt;NilSomething.new&lt;/code&gt;
syntax. We could live with this, or we could find a way to bake that smarts
into &lt;code class=&quot;highlighter-rouge&quot;&gt;NilObject&lt;/code&gt; itself. But how?&lt;/p&gt;

&lt;p&gt;My pair for the week, &lt;a href=&quot;https://twitter.com/timtyrrell&quot;&gt;@timtyrell&lt;/a&gt; came up with
the idea of keying off of the classname of the &lt;code class=&quot;highlighter-rouge&quot;&gt;NilObject&lt;/code&gt; subclass. And that’s
exactly what we did, we made the class parameter optional and keyed off of the
classname.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilObject&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;klass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;vi&quot;&gt;@klass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;klass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;real_class_name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;method_missing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@klass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ends_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'?'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;real_class_name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;constantize&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;real_class_name&lt;/code&gt; method (naming is hard; this should probably be
&lt;code class=&quot;highlighter-rouge&quot;&gt;subject_class_name&lt;/code&gt; or something) takes the name of the class, &lt;code class=&quot;highlighter-rouge&quot;&gt;NilDuck&lt;/code&gt; or
&lt;code class=&quot;highlighter-rouge&quot;&gt;NilGoose&lt;/code&gt; and takes the substring that skips the first 3 letters (the length
of ‘Nil’) to the end. It then turns it into a constant so it can be
instantiated.&lt;/p&gt;

&lt;p&gt;As an added bonus we decided to implement &lt;code class=&quot;highlighter-rouge&quot;&gt;respond_to?&lt;/code&gt; so it behaves exactly
like the subject class would behave.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilObject&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;klass&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;vi&quot;&gt;@klass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;klass&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;real_class_name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;method_missing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;to_s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ends_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'?'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;    &lt;span class=&quot;vi&quot;&gt;@klass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;real_class_name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;constantize&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;So there you have it. We now have a &lt;code class=&quot;highlighter-rouge&quot;&gt;NilObject&lt;/code&gt; that can stand in for any other
object like so: &lt;code class=&quot;highlighter-rouge&quot;&gt;NilObject.new(MyOtherClass)&lt;/code&gt; and it will respond to exactly
the same interface as &lt;code class=&quot;highlighter-rouge&quot;&gt;MyOtherClass&lt;/code&gt; and answer &lt;code class=&quot;highlighter-rouge&quot;&gt;respond_to?&lt;/code&gt; just like an
instance of &lt;code class=&quot;highlighter-rouge&quot;&gt;MyOtherClass&lt;/code&gt; would. If we need to override some of the methods of
&lt;code class=&quot;highlighter-rouge&quot;&gt;MyOtherClass&lt;/code&gt; to return other than &lt;code class=&quot;highlighter-rouge&quot;&gt;nil&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;false&lt;/code&gt; we can create a new
&lt;code class=&quot;highlighter-rouge&quot;&gt;NilMyOtherClass&lt;/code&gt; as a subclass of &lt;code class=&quot;highlighter-rouge&quot;&gt;NilObject&lt;/code&gt; and override what we need to.&lt;/p&gt;

&lt;p&gt;I’ll leave you with a thought exercise. What would happen if you instantiated a
&lt;code class=&quot;highlighter-rouge&quot;&gt;NilObject&lt;/code&gt; without passing a class to the constructor: &lt;code class=&quot;highlighter-rouge&quot;&gt;nil_object =
NilObject.new&lt;/code&gt;? What would you get? As a bonus, how would you make the code
inside the &lt;code class=&quot;highlighter-rouge&quot;&gt;real_class_name&lt;/code&gt; method more intention revealing than what we wrote?
Leave a comment if you know the answers.&lt;/p&gt;</content><author><name>Step Aument</name></author><category term="code" /><summary type="html">In a previous post I described using method_missing in a Null Object to stand in for another object and respond smartly to the original object’s interface. At the end of that post I suggested that you could go farther than we did in creating a more abstract object. Well, we got that chance.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://www.stephenaument.com/%7B%22credit%22=%3E%22Photo%20by%20Ann%20H%20on%20Pexels%22,%20%22feature%22=%3E%22/assets/images/hero/bath-duck-close-up-cute-592677.jpg%22,%20%22topPosition%22=%3E%22-420px%22%7D" /></entry><entry><title type="html">Ruby Hash#fetch and Javascript</title><link href="https://www.stephenaument.com/blog/ruby-hash-dot-fetch-and-javascript/" rel="alternate" type="text/html" title="Ruby Hash#fetch and Javascript" /><published>2014-03-06T19:21:15-06:00</published><updated>2014-03-06T19:21:15-06:00</updated><id>https://www.stephenaument.com/blog/ruby-hash-dot-fetch-and-javascript</id><content type="html" xml:base="https://www.stephenaument.com/blog/ruby-hash-dot-fetch-and-javascript/">&lt;p&gt;In a &lt;a href=&quot;/blog/2014/03/05/the-null-object-pattern-and-method-missing-in-ruby/&quot;&gt;previous
post&lt;/a&gt; I
mentioned a case in which I had a Haml template in a Rails app with Javascript
in it. The template was rendering Ruby values into what would become a JSON
object (Javascript Hash) in the browser. In that particular case, a method call
on a Null Object was returning nil and breaking the Javascript.&lt;/p&gt;

&lt;p&gt;Well, today I encountered another variation of this problem. In this case, I
had a Ruby Hash feeding values into the JSON object. It looked like this:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;gender&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;search_params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'gender'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;language&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;search_params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'language'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;query&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;search_params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'query'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;properties&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;search_params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'properties'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Two of these fields on the ruby hash are empty: &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;language&lt;/span&gt;&lt;/code&gt; and &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;/code&gt;.
Notice that this isn’t a problem for most of these fields, but for one it is:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;gender&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;M&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;27&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;language&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;query&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;specials&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                                                                                                                  &lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;properties&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;See that? The first four fields feed into double quotes as strings. If they are
empty, they are empty. It may cause an issue somewhere down the line, but the
Javascript itself is valid.&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;/code&gt; field, on the other hand is expecting a JSON object. That
missing bit will cause Javascript to blow up once this loads in the browser.&lt;/p&gt;

&lt;p&gt;What’s the solution here? In this case, I turned to &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Hash&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;#fetch&lt;/span&gt;&lt;/code&gt; rather than
the &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;&lt;/code&gt; accessor. What’s the difference? There are two main differences
between the bracket accessor and the &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;fetch&lt;/span&gt;&lt;/code&gt; method. First,
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;my_hash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:some_missing_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;/code&gt; will return &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt; if the key is not found in the
hash. If &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;my_hash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:some_missing_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt; can’t find a key, it will raise a
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;KeyError&lt;/span&gt;&lt;/code&gt; exception.&lt;/p&gt;

&lt;p&gt;That’s not really what we are looking for, which brings me to the second
difference. &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Hash&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;#fetch&lt;/span&gt;&lt;/code&gt; takes an optional second argument which specifies a
default value. So if we call &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;my_hash&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:some_missing_key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'tacos'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt; and
the key is not found in the hash, it will return &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;s1&quot;&gt;'tacos'&lt;/span&gt;&lt;/code&gt; instead of &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;.
That’s exactly what I needed. I returned an empty JSON object &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;&lt;/code&gt; as the
default.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;gender&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;search_params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'gender'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current_user&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;language&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;search_params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'language'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;query&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;search_params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'query'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;properties&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;#{search_params.fetch('properties', {})}&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This degraded nicely in the cases in which I had no &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;/code&gt; hash in my
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;search_params&lt;/span&gt;&lt;/code&gt; hash.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;options&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;gender&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;M&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;27&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;language&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;query&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;specials&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;                                                                                                            &lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;s2&quot;&gt;&quot;properties&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;No more broken Javascript.&lt;/p&gt;</content><author><name>Step Aument</name></author><category term="code" /><summary type="html">In a previous post I mentioned a case in which I had a Haml template in a Rails app with Javascript in it. The template was rendering Ruby values into what would become a JSON object (Javascript Hash) in the browser. In that particular case, a method call on a Null Object was returning nil and breaking the Javascript.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://www.stephenaument.com/%7B%22credit%22=%3E%22Photo%20by%20Mitchell%20Orr%20on%20Unsplash%22,%20%22feature%22=%3E%22/assets/images/hero/mitchell-orr-389605-unsplash.jpg%22,%20%22topPosition%22=%3E%22-200px%22%7D" /></entry><entry><title type="html">The Null Object Pattern and method_missing in Ruby</title><link href="https://www.stephenaument.com/blog/the-null-object-pattern-and-method-missing-in-ruby/" rel="alternate" type="text/html" title="The Null Object Pattern and method_missing in Ruby" /><published>2014-03-05T23:01:09-06:00</published><updated>2014-03-05T23:01:09-06:00</updated><id>https://www.stephenaument.com/blog/the-null-object-pattern-and-method-missing-in-ruby</id><content type="html" xml:base="https://www.stephenaument.com/blog/the-null-object-pattern-and-method-missing-in-ruby/">&lt;p&gt;I encountered an interesting problem this week that allowed me to dig into the
Null Object pattern, Ruby duck typing, and Ruby’s method_missing.&lt;/p&gt;

&lt;p&gt;In our app we have a &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; class (name changed to protect the innocent). Most
of our users have a &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; associated with their account, but some don’t. In
our application, we have certain situations which expect a Duck, even if the
user doesn’t have one. If we don’t have a Duck, but our app expects one and
passes it a message like &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;quack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;/code&gt; we will receive an ugly &lt;code class=&quot;highlighter-rouge&quot;&gt;NoMethodError:
undefined method 'quack' for nil:NilClass&lt;/code&gt; error.&lt;/p&gt;

&lt;p&gt;How can we solve this without spreading smelly nil checks around our system? It
turns out there is an existing design pattern for just this situation, the Null
Object pattern. In the Null Object pattern, we create a stand in object for our
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; that can respond to the same interface, but without returning any
values. We avoid ugly &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NoMethodError&lt;/span&gt;&lt;/code&gt;s without having to check for the objects
existence everywhere.&lt;/p&gt;

&lt;p&gt;Here is our Duck:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Duck&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;awake?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'awake'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;quack&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;quack_style&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This is a Ruby on Rails ActiveRecord model, so there is more to it than we see
here. Here is the database migration file:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CreateDucks&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Migration&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;change&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;integer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hunger&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;quack_style&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;migratory&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;boolean&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;For each of these fields, ActiveRecord will create getter and setter methods in
the background. But for the &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;migratory&lt;/span&gt;&lt;/code&gt; boolean field, we will get the bonus
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;migratory?&lt;/span&gt;&lt;/code&gt; predicate method.&lt;/p&gt;

&lt;p&gt;In our case, it turned out that we need our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; to return &lt;em&gt;some&lt;/em&gt; values,
but most things should just return &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;. The simplest way for us to implement
our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt;, and the state in which I found my &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; code this week looks
something like the following:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilDuck&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;nb&quot;&gt;attr_writer&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:hunger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:quack_style&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:migratory&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Duck'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'sleeping'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;hunger&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;quack&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-19&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;quack_style&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-20&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-21&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-22&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-23&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-24&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'gray'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-25&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-26&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-27&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;awake?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-28&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-29&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-30&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-31&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-32&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-33&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-34&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-35&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-36&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-37&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-38&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Here we have provided the attribute setters our fake object needs with the
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;attr_writer&lt;/span&gt;&lt;/code&gt; call. We then proceed to override each getter as needed. There
are a few special cases in which a value other than nil is desired, but the
default return value for our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; is &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;. In the cases in which we don’t
have an actual &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; and need to use a demo &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt;, we can pass in an instance
of our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; and everything will work as expected.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Note: since Ruby is not a strongly typed language, we don’t have to subclass
our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; here or implement a formal common interface as we would in a
strongly-typed language like Java. In Rubyland, types are determined by the
public interface of the object in question. So if our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt;, or any other
object for that matter, implements the methods our client object calls in
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt;, we can substitute it. This is often called “duck typing,” since if an
object quacks like a duck, and acts like a duck, we can usually consider it a
duck. We &lt;em&gt;do&lt;/em&gt; implement a common interface, but the interface that we
implement is conceptual, represented by the messages to which we expect our
duck to respond. It’s not baked into the language as a formal construct.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;So what’s wrong with this code? Nothing at face value. Maybe it could be
refactored into something less verbose, but it’s functional and fairly
straightforward. In the beginning it served our app quite well. But I came to
this code last week because of a bug uncovered by a change in another area of
the app. It turned out that my &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; code had gotten stale and not kept up
with changes to the &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; class. Methods had been added to &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt;, but not to
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt;. Now &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; looks like this:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Duck&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Base&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;awake?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'awake'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;  &lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;quack&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;puts&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;quack_style&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;multi_colored?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;secondary_color&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;nil?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;And the migration:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CreateDucks&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Migration&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;change&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;integer&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hunger&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;quack_style&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;secondary_color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;migratory&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;boolean&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;We don’t have equivalent &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;secondary_color&lt;/span&gt;&lt;/code&gt; and  &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;multi_colored?&lt;/span&gt;&lt;/code&gt; methods and
our NilDuck started causing errors. Since none of these new methods requirs
special values, I could have just added equivalent getters in NilDuck that
returned &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;. But since I’m a lazy programmer, I asked myself how I could
avoid editing this class in the future. I turned to Ruby’s &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt;!&lt;/p&gt;

&lt;p&gt;In order to understand what my pair and I did here, you need to understand a
little about the way Ruby looks up a method, or message, passed to an object.
When you call a method on a Ruby object, Ruby first looks to see if the method
has been defined on the object instance itself (or more precisely on it’s
&lt;a href=&quot;http://en.wikipedia.org/wiki/Metaclass&quot;&gt;eigenclass&lt;/a&gt;), if it doesn’t find it it
will then look in any included modules in reverse include order, then in the
instance methods of the class, and finally in the instance methods of the
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Object&lt;/span&gt;&lt;/code&gt; class, the ultimate ancestor of every object in Ruby. If Ruby still
can’t find the method, it starts the search over at our instance, this time
trying to call &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt;. If it can’t find a definition for
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt; somewhere in our inheritance chain, only then will it throw a
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NoMethodError&lt;/span&gt;&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt; callback gives us the hook we need to handle our, well,
missing methods. Let’s refactor our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; to use &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt;:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilDuck&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Duck'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'sleeping'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'gray'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;method_missing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-19&quot;&gt;    &lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-20&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-21&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;See what we did there? We want &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; to have the same interface as &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt;,
so in our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;method_missing&lt;/span&gt;&lt;/code&gt; implementation, we first checked to see whether
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; responds to the method our client code attempted to call. If it does, we
return &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;, otherwise we pass the buck to super. Our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; will now
respond to everything that &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; responds to and throw a &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NoMethodError&lt;/span&gt;&lt;/code&gt; for
anything that it doesn’t respond to. As a bonus, we got to eliminate a lot of
code here.&lt;/p&gt;

&lt;p&gt;But what about predicate methods? Well, in Ruby, &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt; is falsey, so this code
will work correctly in an &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;sr&quot;&gt;/unless/&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;/code&gt; situation, but what about a situation
in which you might need &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;migratory?&lt;/span&gt;&lt;/code&gt; to explicitly give you &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;/code&gt; instead of
&lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;? What if you are going to pass that &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/code&gt; or &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;/code&gt; along to someone
else as a string? What if you need to feed it into javascript from an erb or
haml template?&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;multiColored&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// !!! Not a valid JSON object, buddy!&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;If this &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;duck&lt;/span&gt;&lt;/code&gt; is our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt;, &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;duck&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;multi_colored?&lt;/span&gt;&lt;/code&gt; will return &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;. When
the template is rendered and the string is interpolated, &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;’s &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;nb&quot;&gt;to_s&lt;/span&gt;&lt;/code&gt; method
will be invoked, which will return an empty string instead of &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;s1&quot;&gt;'false'&lt;/span&gt;&lt;/code&gt;. This
will result in a javascript error in the browser:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilDuck&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Duck'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'sleeping'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'gray'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;method_missing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-19&quot;&gt;    &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-20&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ends_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'?'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-21&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-22&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Whoops! That’s not what we wanted at all! We want &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;s1&quot;&gt;'true'&lt;/span&gt;&lt;/code&gt; or &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;s1&quot;&gt;'false'&lt;/span&gt;&lt;/code&gt; to be
rendered. How can we handle that? Well, we can fall back and explicitly create
a &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;n&quot;&gt;multi_colored?&lt;/span&gt;&lt;/code&gt; method in our &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt; that returns &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;/code&gt;, but we can do
better than that. Let’s stay lazy so we don’t have to fix this again! Since it
turns out that we don’t really want our predicate methods to return just a
falsey value, but &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;/code&gt; itself. Let’s account for that:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;NilDuck&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-2&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-3&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'Demo Duck'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-4&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-5&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-6&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;status&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-7&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'sleeping'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-8&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-9&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-10&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;color&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-11&quot;&gt;    &lt;span class=&quot;s1&quot;&gt;'gray'&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-12&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-13&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-14&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;migratory?&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-15&quot;&gt;    &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-16&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-17&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line-18&quot;&gt;  &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;method_missing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-19&quot;&gt;    &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;unless&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;respond_to?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-20&quot;&gt;    &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ends_with?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'?'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-21&quot;&gt;  &lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line-22&quot;&gt;&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Now if &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;Duck&lt;/span&gt;&lt;/code&gt; responds to our method and our method ends with ‘?’, &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilDuck&lt;/span&gt;&lt;/code&gt;
will return &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;/code&gt;, if it doesn’t end with ‘?’ it will return &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;kp&quot;&gt;nil&lt;/span&gt;&lt;/code&gt;. Our
template will now render the javascript we expected:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-javascript&quot; data-lang=&quot;javascript&quot;&gt;&lt;div class=&quot;line-1&quot;&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;multiColored&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;You could certainly take this further and abstract out a generic &lt;code class=&quot;highlight language-ruby&quot; data-lang=&quot;ruby&quot;&gt;&lt;span class=&quot;no&quot;&gt;NilObject&lt;/span&gt;&lt;/code&gt;
for your app, but this serves our needs quite well. For further reading on the
Null Object pattern:
&lt;a href=&quot;http://devblog.avdi.org/2011/05/30/null-objects-and-falsiness/&quot;&gt;http://devblog.avdi.org/2011/05/30/null-objects-and-falsiness/&lt;/a&gt;&lt;/p&gt;</content><author><name>Step Aument</name></author><summary type="html">I encountered an interesting problem this week that allowed me to dig into the Null Object pattern, Ruby duck typing, and Ruby’s method_missing.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://www.stephenaument.com/%7B%22credit%22=%3E%22Photo%20by%20Braydon%20Anderson%20on%20Unsplash%22,%20%22feature%22=%3E%22/assets/images/hero/braydon-anderson-105552-unsplash.jpg%22,%20%22topPosition%22=%3E%22-420px%22%7D" /></entry></feed>