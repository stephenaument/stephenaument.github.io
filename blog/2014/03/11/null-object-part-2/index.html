
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Null Object Part 2 - Stephen Aument</title>
	<meta name="author" content="Stephen Aument">

	
	<meta name="description" content="Mar 11th, 2014 Design Patterns Comments Null Object Part 2 In a previous post I
described using method_missing in a Null Object to stand in for &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Stephen Aument" type="application/atom+xml">
	
	<link rel="canonical" href="http://stephenaument.github.io/blog/2014/03/11/null-object-part-2/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<img src="http://www.gravatar.com/avatar/c41cd4784eb5610cb99afc1a7c51124d?s=160" alt="Profile Picture" style="width: 160px;" />
	
</div>
<style>
h2.subtitle {
  font-size: 1em;
  font-style: italic;
}

.initial {
  font-size: 1.2em;
}
</style>

<h1><span class='initial'>S</span>tephen <span class='initial'>A</span>ument</h1>
<h2 class='subtitle'>Professional Dilettante</h2>

<nav id="main-nav"><ul class="main">
    <li><a href="/">Blog</a></li>
    <li><a href="http://about.me/stephenaument">About</a></li>
    <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
			<a class="email" href="mailto:saument@gmail.com" title="Email">Email</a>
		
		
		
		
			<a class="twitter" href="http://twitter.com/saument" title="Twitter">Twitter</a>
		
		
			<a class="github" href="https://github.com/stephenaument" title="GitHub">GitHub</a>
		
		
		
		
			<a class="linkedin" href="http://www.linkedin.com/in/stephenaument" title="LinkedIn">LinkedIn</a>
		
		
		
		
		
		
		
    	
    	
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-03-11T01:00:00-05:00" data-updated="true" itemprop="datePublished">Mar 11<span>th</span>, 2014</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/design-patterns/'>Design Patterns</a>


</div>
		
			<span class="comments"><a href="#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name">Null Object Part 2</h1>
	<div class="entry-content" itemprop="articleBody"><p>In a <a href="/blog/2014/03/05/the-null-object-pattern-and-method-missing-in-ruby/">previous post</a> I
described using <code>method_missing</code> in a Null Object to stand in for another
object and respond smartly to the original object&rsquo;s interface. At the end of
that post I suggested that you could go farther than we did in creating a more
abstract object. Well, we got that chance.</p>

<p>In this post I will show you how we created a <code>NilObject</code> that can both stand
on its own and be extended with added functionality in a subclass. Our
<code>NilObject</code> needs to be smart about the interface of the class that it&rsquo;s
faking, so we&rsquo;ll have to take that into account. Finally, we decided to
implement a smart <code>respond_to?</code> method to round out the functionality of our
<code>NilObject</code>.</p>

<p>Here&rsquo;s the form that our <code>NilDuck</code> took at the end of the previous post:</p>

<div><script src='https://gist.github.com/9422568.js?file=nil_duck_previous.rb'></script>
<noscript><pre><code>class NilDuck &lt; NilObject
  def name
    &#39;Demo Duck&#39;
  end


  def status
    &#39;sleeping&#39;
  end


  def color
    &#39;gray&#39;
  end


  def migratory?
    true
  end
end</code></pre></noscript></div>


<p>A few days after making those changes, we ran into another custom Null Object
in our app, the <code>NilGoose</code>. Our <code>NilGoose</code> ran into the
same problem that <code>NilDuck</code> originally did. A new method was added to the
<code>Goose</code> class that wasn&rsquo;t reflected in <code>NilGoose</code> and a bug appeared.</p>

<p>What to do? Well, we try not to run ahead of ourselves or our tests, so the
first thing we did was create a test that expected the missing method, watched
it fail, and copied the <code>method_missing</code> definition from <code>NilDuck</code>, renaming as
we needed to.</p>

<div><script src='https://gist.github.com/9422568.js?file=nil_goose_initial.rb'></script>
<noscript><pre><code>class NilDuck &lt; NilObject
  def name
    &#39;Demo Duck&#39;
  end


  def status
    &#39;sleeping&#39;
  end


  def color
    &#39;gray&#39;
  end


  def migratory?
    true
  end
end</code></pre></noscript></div>


<p>This made our test happy. But the duplicated code made us sad. We like
<a href="http://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY</a> code around here. We
knew it was time to factor out our common code into a single spot.</p>

<p>We thought about putting it in a Module that could be included into other
special null objects, but decided instead to make it a full-fledged <code>NilObject</code>
class that we could use standalone as well as a superclass for our <code>NilDuck</code>
and <code>NilGoose</code>.</p>

<div><script src='https://gist.github.com/9422568.js?file=nil_object_1.rb'></script>
<noscript><pre><code>class NilDuck &lt; NilObject
  def name
    &#39;Demo Duck&#39;
  end


  def status
    &#39;sleeping&#39;
  end


  def color
    &#39;gray&#39;
  end


  def migratory?
    true
  end
end</code></pre></noscript></div>


<p>If you recall in our <code>method_missing</code> implementation, we had to new up an
instance of our <code>Duck</code> class to determine whether it responds to the method we
are testing. Since we want to reuse this method in the generic <code>NilObject</code>, we
won&rsquo;t know which class to check. Our first pass at a solution requires the
class to be passed into the <code>NilObject</code> constructor, which would look like
<code>faker = NilObject.new(Duck)</code>.</p>

<p>In our <code>initialize</code> method we save the class passed in into an instance
variable, <code>@klass</code>, which <code>method_missing</code> then uses to new up an instance to
check. Now we can fake any class we want with our <code>NilObject</code>, and it will
handle exactly those methods the subject responds to and no others. (Note: If
you&rsquo;re weirded out by passing a class around like that, remember that
everything in Ruby is an object, including classes)</p>

<p>Now we can make <code>NilDuck</code> inherit from <code>NilObject</code>:</p>

<div><script src='https://gist.github.com/9422568.js?file=nil_duck_final.rb'></script>
<noscript><pre><code>class NilDuck &lt; NilObject
  def name
    &#39;Demo Duck&#39;
  end


  def status
    &#39;sleeping&#39;
  end


  def color
    &#39;gray&#39;
  end


  def migratory?
    true
  end
end</code></pre></noscript></div>


<p>and the same for <code>NilGoose</code>:</p>

<div><script src='https://gist.github.com/9422568.js?file=nil_goose_final.rb'></script>
<noscript><pre><code>class NilDuck &lt; NilObject
  def name
    &#39;Demo Duck&#39;
  end


  def status
    &#39;sleeping&#39;
  end


  def color
    &#39;gray&#39;
  end


  def migratory?
    true
  end
end</code></pre></noscript></div>


<p>This is all very cool, but if I leave the code like this I&rsquo;m going to have to
run around and find every place in the app in which I create an instance of
<code>NilDuck</code> or <code>NilGoose</code> and add the new argument. Hopefully it&rsquo;s not very many
places, but this is not something I want to do. Let&rsquo;s go ahead and add
initialize methods to our <code>NilDuck</code> and <code>NilGoose</code> classes to take care of
that:</p>

<div><script src='https://gist.github.com/9422568.js?file=nil_duck_intermediate.rb'></script>
<noscript><pre><code>class NilDuck &lt; NilObject
  def name
    &#39;Demo Duck&#39;
  end

  def status
    &#39;sleeping&#39;
  end

  def color
    &#39;gray&#39;
  end

  def migratory?
    true
  end
end</code></pre></noscript></div>


<p>and</p>

<div><script src='https://gist.github.com/9422568.js?file=nil_goose_intermediate.rb'></script>
<noscript><pre><code>class NilDuck &lt; NilObject
  def name
    &#39;Demo Duck&#39;
  end

  def status
    &#39;sleeping&#39;
  end

  def color
    &#39;gray&#39;
  end

  def migratory?
    true
  end
end</code></pre></noscript></div>


<p>That works, and it keeps us from having to spread changes around the codebase,
but it does add to the duplication a bit. That initialize method needs to be
added to every new subclass in order to get the shorter <code>NilSomething.new</code>
syntax. We could live with this, or we could find a way to bake that smarts
into <code>NilObject</code> itself. But how?</p>

<p>My pair for the week, <a href="https://twitter.com/timtyrrell">@timtyrell</a> came up with
the idea of keying off of the classname of the <code>NilObject</code> subclass. And that&rsquo;s
exactly what we did, we made the class parameter optional and keyed off of the
classname.</p>

<div><script src='https://gist.github.com/9422568.js?file=nil_object_2.rb'></script>
<noscript><pre><code>class NilDuck &lt; NilObject
  def name
    &#39;Demo Duck&#39;
  end


  def status
    &#39;sleeping&#39;
  end


  def color
    &#39;gray&#39;
  end


  def migratory?
    true
  end
end</code></pre></noscript></div>


<p>The <code>real_class_name</code> method (naming is hard; this should probably be
<code>subject_class_name</code> or something) takes the name of the class, <code>NilDuck</code> or
<code>NilGoose</code> and takes the substring that skips the first 3 letters (the length
of &lsquo;Nil&rsquo;) to the end. It then turns it into a constant so it can be
instantiated.</p>

<p>As an added bonus we decided to implement <code>respond_to?</code> so it behaves exactly
like the subject class would behave.</p>

<div><script src='https://gist.github.com/9422568.js?file=nil_object_final.rb'></script>
<noscript><pre><code>class NilDuck &lt; NilObject
  def name
    &#39;Demo Duck&#39;
  end

  def status
    &#39;sleeping&#39;
  end

  def color
    &#39;gray&#39;
  end

  def migratory?
    true
  end
end</code></pre></noscript></div>


<p>So there you have it. We now have a <code>NilObject</code> that can stand in for any other
object like so: <code>NilObject.new(MyOtherClass)</code> and it will respond to exactly
the same interface as <code>MyOtherClass</code> and answer <code>respond_to?</code> just like an
instance of <code>MyOtherClass</code> would. If we need to override some of the methods of
<code>MyOtherClass</code> to return other than <code>nil</code> or <code>false</code> we can create a new
<code>NilMyOtherClass</code> as a subclass of <code>NilObject</code> and override what we need to.</p>

<p>I&rsquo;ll leave you with a thought exercise. What would happen if you instantiated a
<code>NilObject</code> without passing a class to the constructor: <code>nil_object =
NilObject.new</code>? What would you get? As a bonus, how would you make the code
inside the <code>real_class_name</code> method more intention revealing than what we wrote?
Leave a comment if you know the answers.</p>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite">

<script type="text/javascript">
      var disqus_shortname = 'stephenaument';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://stephenaument.github.io/blog/2014/03/11/null-object-part-2/';
        var disqus_url = 'http://stephenaument.github.io/blog/2014/03/11/null-object-part-2/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>

</div>
</section>

</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2014

    Stephen Aument


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
		</div>
	</div>
</body>
</html>
